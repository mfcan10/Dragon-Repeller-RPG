(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();class P{constructor(){this.ctx=null,this.currentMusic=null,this.init()}init(){try{this.ctx=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.error("Web Audio API not supported",e)}}resume(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume()}createOscillator(e,t,s,i){if(!this.ctx)return null;const l=this.ctx.createOscillator(),r=this.ctx.createGain();return l.type=e,l.frequency.setValueAtTime(t,s),l.connect(r),r.connect(this.ctx.destination),{osc:l,gain:r}}playTone({freq:e,type:t="sine",duration:s=.1,vol:i=.1,slideTo:l=null}){if(!this.ctx)return;this.resume();const r=this.ctx.currentTime,{osc:h,gain:c}=this.createOscillator(t,e,r);c.gain.setValueAtTime(i,r),c.gain.exponentialRampToValueAtTime(.01,r+s),l&&h.frequency.exponentialRampToValueAtTime(l,r+s),h.start(r),h.stop(r+s)}playSwordSwing(){this.playTone({freq:200,slideTo:100,duration:.1,vol:.3})}playDaggerSwing(){this.playTone({freq:300,slideTo:150,duration:.08,vol:.25})}playHammerSwing(){this.playTone({freq:150,slideTo:80,duration:.15,vol:.4})}playSwordHit(){this.playTone({freq:400,type:"square",slideTo:200,duration:.2,vol:.3})}playDamage(){if(!this.ctx)return;this.resume();const e=this.ctx.currentTime,t=this.createOscillator("sawtooth",150,e);t.gain.gain.setValueAtTime(.4,e),t.gain.gain.exponentialRampToValueAtTime(.01,e+.3),t.osc.frequency.exponentialRampToValueAtTime(100,e+.3),t.osc.start(e),t.osc.stop(e+.3);const s=this.createOscillator("triangle",200,e);s.gain.gain.setValueAtTime(.4,e),s.gain.gain.exponentialRampToValueAtTime(.01,e+.3),s.osc.frequency.exponentialRampToValueAtTime(120,e+.3),s.osc.start(e),s.osc.stop(e+.3)}playWinMusic(){if(!this.ctx)return;this.stopMusic();const e=[{freq:523.25,time:0},{freq:659.25,time:.2},{freq:783.99,time:.4},{freq:1046.5,time:.6},{freq:783.99,time:.8},{freq:1046.5,time:1},{freq:1318.51,time:1.2},{freq:1567.98,time:1.4}];this.playSequence(e)}playLoseMusic(){if(!this.ctx)return;this.stopMusic();const e=[{freq:220,time:0,type:"sawtooth"},{freq:196,time:.3,type:"sawtooth"},{freq:174.61,time:.6,type:"sawtooth"},{freq:155.56,time:.9,type:"sawtooth"},{freq:146.83,time:1.2,type:"sawtooth"}];this.playSequence(e)}playSequence(e){e.forEach(t=>{setTimeout(()=>{this.playTone({freq:t.freq,type:t.type||"sine",duration:.3,vol:.2})},t.time*1e3)})}stopMusic(){this.currentMusic}}class q{constructor(){this.xp=0,this.health=100,this.gold=50,this.currentWeapon=0,this.inventory=["stick"],this.fighting=null,this.monsterHealth=0}reset(){this.xp=0,this.health=100,this.gold=50,this.currentWeapon=0,this.inventory=["stick"],this.fighting=null,this.monsterHealth=0}load(e){Object.assign(this,e)}serialize(){return{xp:this.xp,gold:this.gold,health:this.health,currentWeapon:this.currentWeapon,inventory:this.inventory}}}const n=new q,S="DRAGON_REPELLER_2024_SECURE_KEY",M={async save(a){try{const e=JSON.stringify(a),t=await Y(e);return localStorage.setItem("dr_game_data",t),!0}catch(e){return console.error("Failed to save game:",e),!1}},async load(){try{const a=localStorage.getItem("dr_game_data");if(!a)return null;const e=await F(a);return e?JSON.parse(e):null}catch(a){return console.error("Failed to load game:",a),null}},reset(){localStorage.removeItem("dr_game_data")}};async function Y(a){try{const e=new TextEncoder,t=e.encode(a),s=await crypto.subtle.importKey("raw",e.encode(S),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),i=crypto.getRandomValues(new Uint8Array(16)),l=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt"]),r=crypto.getRandomValues(new Uint8Array(12)),h=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},l,t),c=new Uint8Array(i.length+r.length+h.byteLength);return c.set(i,0),c.set(r,i.length),c.set(new Uint8Array(h),i.length+r.length),btoa(String.fromCharCode(...c))}catch{return W(a)}}async function F(a){try{const e=new TextEncoder,t=new TextDecoder,s=Uint8Array.from(atob(a),g=>g.charCodeAt(0)),i=s.slice(0,16),l=s.slice(16,28),r=s.slice(28),h=await crypto.subtle.importKey("raw",e.encode(S),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),c=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:1e5,hash:"SHA-256"},h,{name:"AES-GCM",length:256},!1,["decrypt"]),u=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},c,r);return t.decode(u)}catch{return G(a)}}function W(a){const e=S+"_X",t=Math.random().toString(36).substring(2,15);let s="";for(let i=0;i<a.length;i++){const l=a.charCodeAt(i),r=e.charCodeAt(i%e.length),h=t.charCodeAt(i%t.length),c=l^r^h;s+=String.fromCharCode(c)}return btoa(t+":"+s)}function G(a){try{const e=S+"_X",s=atob(a).split(":");if(s.length!==2)return null;const i=s[0],l=s[1];let r="";for(let h=0;h<l.length;h++){const c=l.charCodeAt(h),u=e.charCodeAt(h%e.length),g=i.charCodeAt(h%i.length),f=c^u^g;r+=String.fromCharCode(f)}return r}catch{return null}}class N{constructor(){this.elements={xpText:document.getElementById("xpText"),xpFill:document.getElementById("xpFill"),healthText:document.getElementById("healthText"),healthFill:document.getElementById("healthFill"),goldText:document.getElementById("goldText"),monsterStats:document.getElementById("monsterStats"),monsterName:document.getElementById("monsterName"),monsterHealth:document.getElementById("monsterHealth"),monsterHealthFill:document.getElementById("monsterHealthFill"),button1:document.getElementById("button1"),button2:document.getElementById("button2"),button3:document.getElementById("button3"),text:document.getElementById("text"),combatArea:document.getElementById("combatArea"),monsterImage:document.getElementById("monsterImage"),monsterNameDisplay:document.getElementById("monsterNameDisplay"),player:document.getElementById("player"),locationImage:document.getElementById("locationImage"),locationImageContainer:document.getElementById("locationImageContainer"),winOverlay:document.getElementById("winOverlay"),loseOverlay:document.getElementById("loseOverlay"),winMessage:document.getElementById("winMessage"),loseMessage:document.getElementById("loseMessage"),winRestart:document.getElementById("winRestart"),loseRestart:document.getElementById("loseRestart")},this.currentMonsterMaxHealth=100}updateStats(e){this.elements.xpText.innerText=e.xp,this.elements.healthText.innerText=e.health,this.elements.goldText.innerText=e.gold;const t=e.xp%100;this.elements.xpFill&&(this.elements.xpFill.style.width=`${t}%`);const s=Math.min(100,Math.max(0,e.health));this.elements.healthFill&&(this.elements.healthFill.style.width=`${s}%`,this.elements.healthFill.style.backgroundColor=e.health<30?"#ff4444":"#44ff44")}updateLocation(e,t){this.elements.text.innerText=e.text,this.elements.button1.innerText=e["button text"][0],this.elements.button2.innerText=e["button text"][1],this.elements.button3.innerText=e["button text"][2],this.elements.button1.onclick=t[0],this.elements.button2.onclick=t[1],this.elements.button3.onclick=t[2],this.elements.combatArea&&(this.elements.combatArea.style.display="none",this.elements.monsterStats.style.display="none"),this.elements.locationImage&&e.image&&(this.elements.locationImage.src=e.image,this.elements.locationImageContainer.className=e.imageClass||"",this.elements.locationImageContainer.style.display="flex")}showCombat(e){this.elements.monsterStats.style.display="flex",this.elements.combatArea.style.display="block",this.elements.locationImageContainer.style.display="none",this.elements.monsterName.innerText=e.name,this.elements.monsterHealth.innerText=`${e.health} / ${e.health}`,this.currentMonsterMaxHealth=e.health,this.updateMonsterHealth(e.health),this.elements.monsterImage.innerText=e.image,this.elements.monsterNameDisplay.innerText=e.name,this.elements.monsterImage.className=""}updateMonsterHealth(e){if(this.elements.monsterHealth.innerText=`${e} / ${this.currentMonsterMaxHealth}`,this.elements.monsterHealthFill){const t=e/this.currentMonsterMaxHealth*100;this.elements.monsterHealthFill.style.width=`${Math.max(0,t)}%`}}setMessage(e){this.elements.text.innerText=e}animatePlayerAttack(){this.elements.player.classList.add("player-attack"),setTimeout(()=>{this.elements.player.classList.remove("player-attack")},500)}animateMonsterHit(){this.elements.monsterImage.classList.add("monster-hit");const e=document.getElementById("game");e.classList.add("shake-screen"),setTimeout(()=>{this.elements.monsterImage.classList.remove("monster-hit"),e.classList.remove("shake-screen")},500)}animatePlayerHit(){this.elements.player.classList.add("player-hit"),document.body.classList.add("flash-red"),setTimeout(()=>{this.elements.player.classList.remove("player-hit"),document.body.classList.remove("flash-red")},500)}animatePlayerDodge(){this.elements.player.classList.add("player-dodge"),setTimeout(()=>{this.elements.player.classList.remove("player-dodge")},500)}animateMonsterAttack(){this.elements.monsterImage.classList.add("monster-attack"),setTimeout(()=>{this.elements.monsterImage.classList.remove("monster-attack")},500)}showWinOverlay(e){this.elements.winMessage.innerText=e,this.elements.winOverlay.classList.add("win-overlay-show")}showLoseOverlay(e){this.elements.loseMessage.innerText=e,this.elements.loseOverlay.classList.add("lose-overlay-show")}}const o=new N;class K{constructor(e,t,s){this.state=e,this.audio=t,this.ui=s}async attack(e,t){this.audio.resume(),this.audio.playSwordSwing(),this.ui.animatePlayerAttack(),await new Promise(h=>setTimeout(h,250)),this.ui.animateMonsterHit(),this.audio.playSwordHit();const s=Math.random()<.3;let i="";s?i=`The ${e.name} attacks, but you dodge it!`:i=`The ${e.name} attacks.`,i+=` You attack it with your ${t[this.state.currentWeapon].name}.`,this.ui.setMessage(i),await new Promise(h=>setTimeout(h,300)),s||(this.state.health-=e.level,this.ui.animatePlayerHit(),this.audio.playDamage());const r=t[this.state.currentWeapon].power+(this.state.currentWeapon>0?Math.floor(Math.random()*this.state.xp)+1:0);return this.state.monsterHealth-=r,{playerHealth:this.state.health,monsterHealth:this.state.monsterHealth,avoidDamage:s}}async dodge(e){this.audio.resume();const t=Math.random()<.6;return this.ui.animateMonsterAttack(),t?(this.ui.animatePlayerDodge(),this.ui.setMessage(`You successfully dodge the attack from the ${e.name}!`)):(this.ui.animatePlayerHit(),this.audio.playDamage(),this.state.health-=e.level,this.ui.setMessage(`You tried to dodge but failed! The ${e.name} hits you for ${e.level} damage.`)),{success:t,playerHealth:this.state.health}}}class V{constructor(){this.keys={ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1,w:!1,a:!1,s:!1,d:!1,Enter:!1},window.addEventListener("keydown",e=>{this.keys.hasOwnProperty(e.key)&&(this.keys[e.key]=!0)}),window.addEventListener("keyup",e=>{this.keys.hasOwnProperty(e.key)&&(this.keys[e.key]=!1)})}get direction(){let e=0,t=0;return(this.keys.ArrowLeft||this.keys.a)&&(e=-1),(this.keys.ArrowRight||this.keys.d)&&(e=1),(this.keys.ArrowUp||this.keys.w)&&(t=-1),(this.keys.ArrowDown||this.keys.s)&&(t=1),{x:e,y:t}}}class _{constructor(e){this.tileSize=e,this.mapData=null,this.tileset=new Image,this.tileset.src="assets/sprites/tileset.png",this.isLoaded=!1,this.tileset.onload=()=>{this.isLoaded=!0},this.slimeSprite=new Image,this.slimeSprite.src="assets/sprites/slime.png",this.beastSprite=new Image,this.beastSprite.src="assets/sprites/beast.png",this.dragonSprite=new Image,this.dragonSprite.src="assets/sprites/dragon.png",this.decorSprites=new Image,this.decorSprites.src="assets/sprites/cave_animals.png",this.tileAtlas={0:[0,0],1:[1,0],2:[2,0],3:[3,0],4:[3,0],8:[3,0],5:[3,0],6:[3,0],7:[3,0],9:[3,0],10:[3,0],11:[3,0],12:[3,0]}}load(e){this.mapData=e}draw(e){if(!(!this.mapData||!this.isLoaded)){for(let t=0;t<this.mapData.height;t++)for(let s=0;s<this.mapData.width;s++){const i=this.mapData.data[t][s],l=this.tileAtlas[i]||[0,0];e.drawImage(this.tileset,l[0]*32,l[1]*32,32,32,s*this.tileSize,t*this.tileSize,this.tileSize,this.tileSize),i===5?this.drawMonster(e,s,t,0):i===6?this.drawMonster(e,s,t,1):i===7?this.drawMonster(e,s,t,2):i===9?this.drawDecor(e,s,t,0):i===10?this.drawDecor(e,s,t,1):i===11?this.drawDecor(e,s,t,2):i===12&&this.drawDecor(e,s,t,3)}e.fillStyle="white",e.font="bold 12px Inter",e.textAlign="center",e.shadowColor="black",e.shadowBlur=4,this.mapData.labels&&this.mapData.labels.forEach(t=>{e.fillText(t.text,t.x*this.tileSize+this.tileSize/2,t.y*this.tileSize+this.tileSize/2)}),e.shadowBlur=0}}isSolid(e,t){return!this.mapData||e<0||e>=this.mapData.width||t<0||t>=this.mapData.height?!0:this.mapData.data[t][e]===1}drawMonster(e,t,s,i){let l=this.slimeSprite;i===1&&(l=this.beastSprite),i===2&&(l=this.dragonSprite);let r=0,h=0;i===0?(r=(t-1)*32,h=(s-1)*32):i===1?(r=(t-12)*32,h=(s-1)*32):i===2&&(r=(t-12)*32,h=(s-7)*32),r=Math.max(0,Math.min(32,r)),h=Math.max(0,Math.min(32,h)),e.drawImage(l,r,h,32,32,t*this.tileSize,s*this.tileSize,this.tileSize,this.tileSize)}drawDecor(e,t,s,i){const l=i%2*32,r=Math.floor(i/2)*32;e.drawImage(this.decorSprites,l,r,32,32,t*this.tileSize,s*this.tileSize,this.tileSize,this.tileSize)}getZone(e,t){if(!this.mapData||e<0||e>=this.mapData.width||t<0||t>=this.mapData.height)return null;const s=this.mapData.data[t][e];return this.mapData.zones[s]||null}}class Z{constructor(e,t,s,i,l){this.x=e,this.y=t,this.tileSize=s,this.map=i,this.input=l,this.speed=4,this.size=s,this.sprite=new Image,this.sprite.src="assets/sprites/hero.png",this.frame=0,this.frameCount=0,this.direction=0}update(){const e=this.input.direction;let t=!1;if(e.x!==0||e.y!==0){const s=this.x+e.x*this.speed,i=this.y+e.y*this.speed;Math.floor((s+this.tileSize/2)/this.tileSize),Math.floor((i+this.tileSize/2)/this.tileSize);const l=this.x+e.x*this.speed,r=Math.floor((l+4)/this.tileSize),h=Math.floor((l+this.tileSize-4)/this.tileSize),c=Math.floor((this.y+10)/this.tileSize),u=Math.floor((this.y+this.tileSize-2)/this.tileSize);!this.map.isSolid(r,c)&&!this.map.isSolid(h,c)&&!this.map.isSolid(r,u)&&!this.map.isSolid(h,u)&&(this.x+=e.x*this.speed,t=!0);const g=this.y+e.y*this.speed,f=Math.floor((this.x+4)/this.tileSize),A=Math.floor((this.x+this.tileSize-4)/this.tileSize),E=Math.floor((g+10)/this.tileSize),z=Math.floor((g+this.tileSize-2)/this.tileSize);!this.map.isSolid(f,E)&&!this.map.isSolid(A,E)&&!this.map.isSolid(f,z)&&!this.map.isSolid(A,z)&&(this.y+=e.y*this.speed,t=!0)}return t}draw(e){e.fillStyle="rgba(0,0,0,0.3)",e.beginPath(),e.ellipse(this.x+this.tileSize/2,this.y+this.tileSize-5,10,5,0,0,Math.PI*2),e.fill(),this.sprite.complete&&this.sprite.naturalHeight!==0?e.drawImage(this.sprite,this.x,this.y,this.tileSize,this.tileSize):(e.fillStyle="#ffd700",e.beginPath(),e.arc(this.x+this.tileSize/2,this.y+this.tileSize/2,this.tileSize/3,0,Math.PI*2),e.fill())}checkZone(){const e=this.x+this.tileSize/2,t=this.y+this.tileSize/2,s=Math.floor(e/this.tileSize),i=Math.floor(t/this.tileSize);return this.map.getZone(s,i)}}class ${constructor(e,t){this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.onZoneChange=t,this.tileSize=40,this.input=new V,this.map=new _(this.tileSize),this.player=new Z(0,0,this.tileSize,this.map,this.input),this.isRunning=!1,this.lastZone=null}loadMap(e,t,s){this.map.load(e),this.canvas.width=e.width*this.tileSize,this.canvas.height=e.height*this.tileSize,t!==void 0&&s!==void 0?(this.player.x=t*this.tileSize,this.player.y=s*this.tileSize):(this.player.x=e.startPos.x*this.tileSize,this.player.y=e.startPos.y*this.tileSize),this.lastZone=null}start(){this.isRunning||(this.isRunning=!0,this.loop())}stop(){this.isRunning=!1}loop(){this.isRunning&&(this.update(),this.draw(),requestAnimationFrame(()=>this.loop()))}update(){if(this.player.update()){const t=this.player.checkZone();t&&t!==this.lastZone?(this.onZoneChange(t),this.lastZone=t):t||(this.lastZone=null)}}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.map.draw(this.ctx),this.player.draw(this.ctx)}}const B={town:{width:15,height:10,data:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,2,2,1,1,1,0,0,0,1],[1,0,0,1,2,2,2,2,2,2,1,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,0,0,0,3,3,0,0,0,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],zones:{2:"store",3:"cave"},labels:[{text:"STORE",x:7,y:4},{text:"CAVE",x:7,y:9.2}],startPos:{x:7,y:5}},cave:{width:15,height:10,data:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,5,5,1,8,8,8,8,8,8,8,1,6,6,1],[1,5,5,8,8,12,8,8,8,8,10,8,6,6,1],[1,1,1,1,1,8,8,8,8,8,1,1,1,1,1],[1,9,8,8,8,8,8,8,8,8,8,8,8,9,1],[1,8,8,11,8,8,8,8,8,8,8,8,11,8,1],[1,1,1,1,1,8,8,8,8,8,1,1,1,1,1],[1,4,4,8,8,8,8,8,8,8,8,8,7,7,1],[1,4,4,8,8,12,8,8,8,8,10,8,7,7,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],zones:{4:"town",5:"slime",6:"beast",7:"dragon"},labels:[{text:"EXIT",x:2,y:8.5},{text:"SLIME",x:2,y:2.5},{text:"BEAST",x:13,y:2.5},{text:"DRAGON",x:13,y:8.5}],startPos:{x:2,y:5}}},x=new P,C=new K(n,x,o);let m=null;const p=[{name:"slime",level:2,health:15,image:"ðŸŸ¢"},{name:"fanged beast",level:8,health:60,image:"ðŸº"},{name:"dragon",level:20,health:300,image:"ðŸ‰"}],w=[{name:"stick",power:5},{name:"dagger",power:30},{name:"claw hammer",power:50},{name:"sword",power:100}],T=[{name:"town square","button text":["Go to store","Go to cave","Fight dragon"],"button functions":[D,d,R],text:"You are in the town square. Use ARROW KEYS to move.",image:"https://images.unsplash.com/photo-1515542622106-78bda8ba0e5b?w=800&h=600&fit=crop",imageClass:"town"},{name:"store","button text":["Buy 10 health (10 gold)","Buy weapon (30 gold)","Back to Town"],"button functions":[X,j,y],text:"You are in the store. You see a sign that says 'Store'.",image:"https://images.unsplash.com/photo-1708409858781-30df7a234f2d?w=800&h=600&fit=crop",imageClass:"store"},{name:"cave","button text":["Fight slime","Fight fanged beast","Back to Town"],"button functions":[L,H,y],text:"You are in the cave. Use ARROW KEYS to find monsters.",image:"https://images.unsplash.com/photo-1517239320384-e08ad2c24a3e?w=800&h=600&fit=crop",imageClass:"cave"}];function U(a){a==="store"?D():a==="cave"?d():a==="town"?y():a==="slime"?L():a==="beast"?H():a==="dragon"&&R()}function b(a){const e=document.getElementById("game-canvas-container"),t=document.getElementById("controls"),s=document.getElementById("locationImageContainer");a?(e.style.display="flex",t.style.display="none",s.style.display="none",m&&m.start()):(e.style.display="none",t.style.display="grid",s.style.display="flex",m&&m.stop())}function I(a){o.updateLocation(a,a["button functions"])}function y(){I(T[0]),m&&m.loadMap(B.town),b(!0)}function D(){I(T[1]),b(!1)}function d(a,e){I(T[2]),m&&m.loadMap(B.cave,a,e),b(!0)}function X(){n.gold>=10?(n.gold-=10,n.health+=10,o.updateStats(n),o.setMessage("You bought 10 health for 10 gold.")):o.setMessage("You do not have enough gold to buy health.")}function j(){n.currentWeapon<w.length-1?n.gold>=30?(n.gold-=30,n.currentWeapon++,n.inventory.push(w[n.currentWeapon].name),o.updateStats(n),o.setMessage("You now have a "+w[n.currentWeapon].name+".")):o.setMessage("You do not have enough gold to buy a weapon."):(o.setMessage("You already have the best weapon!"),o.elements.button2.innerText="Sell weapon for 15 gold",o.elements.button2.onclick=J)}function J(){n.inventory.length>1&&(n.gold+=15,n.currentWeapon--,n.inventory.pop(),o.updateStats(n),o.setMessage("You sold a weapon for 15 gold."))}function L(){n.fighting=0,k()}function H(){n.fighting=1,k()}function R(){n.fighting=2,k()}function k(){b(!1);const a=p[n.fighting];n.monsterHealth=a.health,o.showCombat(a),o.setMessage("You are fighting a "+a.name+". What do you want to do?"),o.elements.button1.innerText="Attack",o.elements.button2.innerText="Dodge",o.elements.button3.innerText="Run",o.elements.button1.onclick=Q,o.elements.button2.onclick=ee,o.elements.button3.onclick=()=>{n.fighting===0?d(3.5,2):n.fighting===1?d(11.5,2):n.fighting===2?d(11.5,8):d()}}async function Q(){const a=p[n.fighting];await C.attack(a,w),o.updateStats(n),o.updateMonsterHealth(n.monsterHealth),n.health<=0?O():n.monsterHealth<=0&&(n.fighting===2?se():te()),M.save(n.serialize())}async function ee(){const a=p[n.fighting];await C.dodge(a),o.updateStats(n),n.health<=0&&O()}function te(){n.gold+=Math.floor(p[n.fighting].level*6.7),n.xp+=p[n.fighting].level,o.updateStats(n),o.setMessage('The monster screams "Arg!" as it dies. You gain experience points and find gold.'),o.elements.button1.innerText="Back to Map",o.elements.button2.innerText="Back to Map",o.elements.button3.innerText="Back to Map";const a=()=>{n.fighting===0?d(3.5,2):n.fighting===1?d(11.5,2):n.fighting===2?d(11.5,8):d(),o.elements.combatArea.style.display="none",o.elements.monsterStats.style.display="none"};o.elements.button1.onclick=a,o.elements.button2.onclick=a,o.elements.button3.onclick=a}function O(){o.updateStats(n),o.showLoseOverlay("You have died. The dragon reclaims the town."),x.playLoseMusic(),m&&m.stop()}function se(){o.updateStats(n),o.showWinOverlay("You defeat the dragon! THE TOWN IS SAVED!"),x.playWinMusic(),m&&m.stop()}function v(){confirm("Are you sure you want to reset the game?")&&(M.reset(),n.reset(),o.updateStats(n),y(),o.elements.winOverlay.classList.remove("win-overlay-show"),o.elements.loseOverlay.classList.remove("lose-overlay-show"),o.elements.button1.disabled=!1)}async function ie(){const a=await M.load();a&&n.load(a),o.updateStats(n),m=new $("gameCanvas",U),y(),document.getElementById("resetButton")&&(document.getElementById("resetButton").onclick=v),o.elements.winRestart&&(o.elements.winRestart.onclick=v),o.elements.loseRestart&&(o.elements.loseRestart.onclick=v),document.body.onclick=()=>{x.resume()}}ie();
